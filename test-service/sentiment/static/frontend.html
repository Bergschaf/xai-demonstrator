<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>XAI Demonstrator Customer Review Sentiment</title>
    <script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
</head>
<body style="margin: 0;">
<div id="app" style="width: 100%; max-width: 500px; margin: 0 auto;">
    <table style="margin: 0 auto;">
        <tr>
            <td><strong>Sentiment Explainer</strong></td>
        </tr>
        <tr>
            <td><textarea ref="input" id="input" style="width: 80vw; height: 30vh; font-size: 12pt;"></textarea></td>
        </tr>
        <tr>
            <td>
                <button v-on:click="onPredictButtonClick" style="width: 80vw; height: 10vh;">Predict</button>
            </td>
        </tr>
        <tr>
            <td>
                <button v-on:click="onExplainButtonClick" style="width: 80vw; height: 10vh;">Predict & Explain</button>
            </td>
        </tr>
        <tr>
            <td><strong>Sentiment:</strong> {{ sentiment }}</td>
        </tr>
        <tr>
            <td><strong>Explanation:</strong> {{ explanation }}</td>
        </tr>
    </table>

</div>
<script>
    new Vue({
        el: '#app',
        data() {
            return {
                explanation: null,
                sentiment: null
            }
        },
        methods: {
            onExplainButtonClick() {
                console.log(this.$refs.input.value)
                axios
                    .post('/explain', {"text": this.$refs.input.value})
                    .then(response => {
                        this.explanation = response.data.explanation.explanation
                        this.sentiment = "★".repeat(response.data.prediction.prediction.map((x, i) => [x, i]).reduce((r, a) => (a[0] > r[0] ? a : r))[1] + 1)
                    })
            },
            onPredictButtonClick() {
                console.log(this.$refs.input.value)
                axios
                    .post('/predict', {"text": this.$refs.input.value})
                    .then(response => {
                        this.explanation = ""
                        this.sentiment = "★".repeat(response.data.prediction.map((x, i) => [x, i]).reduce((r, a) => (a[0] > r[0] ? a : r))[1] + 1)
                    })
            }
        }
    })
</script>
</body>
</html>
